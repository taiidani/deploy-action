[env]
# Local environment variables
_.file = '.env'
VAULT_ADDR = "https://rnd.vault.0846e66f-a975-4a88-9e46-6dc6267e9b73.aws.hashicorp.cloud:8200"
VAULT_NAMESPACE = "admin"

[tools]
# Vault is used for secrets management via Vault Agent
vault = "latest"

[tasks.render-secrets]
description = "Render secrets for Docker Compose services using Vault Agent"
run = "vault agent --config=vault_config.hcl -exit-after-auth"

[tasks.deploy]
description = "Deploy a service with optional artifact"
run = """
#!/usr/bin/env bash
set -e

SERVICE="${1:?Service name required}"
ARTIFACT="${2:-}"

echo "ðŸš€ Deploying service: $SERVICE"

# Navigate to service directory
cd "$SERVICE"

# Deploy with or without artifact
if [ -n "$ARTIFACT" ]; then
  echo "ðŸ“¦ Deploying with artifact: $ARTIFACT"
  ARTIFACT="$ARTIFACT" docker compose up -d --build --wait
else
  echo "ðŸ“¦ Deploying without artifact..."
  docker compose up -d --build --wait
fi

# Show status
echo ""
echo "âœ… Deployment complete!"
docker compose ps
"""
